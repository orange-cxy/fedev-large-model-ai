# 大型模型AI交互系统

这是一个经过全面重构的大型模型AI交互系统，采用前后端分离架构，提供完整的AI模型管理、对话交互、工具调用和系统配置功能。系统支持多种AI模型接入，提供统一的API接口和灵活的配置管理机制。

* 项目地址：https://github.com/orange-cxy/fedev-large-model-ai
* 预览地址：https://orange-cxy.github.io/fedev-large-model-ai/

## 项目特点

- **完整的后端架构**：基于Node.js和Express构建的高性能后端服务
- **多模型支持**：集成多种AI模型提供商，支持统一的模型管理接口
- **灵活的工具调用**：提供丰富的工具函数和服务，支持AI模型的工具调用能力
- **动态配置管理**：支持实时配置更新、验证、备份和历史版本管理
- **全面的安全机制**：API密钥认证、请求限流、输入验证和数据加密
- **完善的错误处理**：统一的错误响应格式和详细的日志记录
- **响应式前端设计**：适配各种设备尺寸的现代化用户界面
- **流式数据处理**：支持实时流式响应和渲染

## 技术栈

### 前端技术
- **HTML5**：语义化页面结构
- **CSS3**：现代样式和响应式设计
- **JavaScript (ES Modules)**：模块化前端开发
- **Vite**：下一代前端构建工具
- **Fetch API**：处理HTTP请求
- **Streams API**：处理流式数据传输
- **marked.js**：Markdown渲染库

### 后端技术
- **Node.js**：JavaScript运行时环境
- **Express**：高性能Web框架
- **中间件生态**：CORS、限流、安全头、请求日志等
- **模块化架构**：控制器、服务、中间件、工具的清晰分层
- **配置管理**：环境变量和动态配置系统
- **数据验证**：请求参数验证和响应标准化

### AI模型集成
- **统一模型接口**：支持多种AI模型服务的标准接入
- **响应标准化**：统一不同模型的响应格式
- **工具调用框架**：支持AI模型的函数调用能力

### 开发工具
- **ESLint**：代码质量检查
- **Mocha & Chai**：单元测试和集成测试
- **Supertest**：API测试工具
- **环境管理**：开发、测试和生产环境配置

## 系统架构

系统采用经典的分层架构设计，实现了关注点分离和模块解耦，便于维护和扩展。

```
┌─────────────────────────────────────────────────────────────────────┐
│                           前端应用层                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────────┐  │
│  │ 用户界面组件 │  │ 状态管理    │  │ API服务客户端               │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           API路由层                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │ 对话路由    │  │ 模型路由    │  │ 工具路由    │  │ 系统路由    │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  ┌─────────────┐  ┌─────────────┐                                    │
│  │ 配置路由    │  │ 健康检查路由│                                    │
│  └─────────────┘  └─────────────┘                                    │
└─────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           中间件层                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │ 安全中间件  │  │ CORS中间件  │  │ 限流中间件  │  │ 日志中间件  │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  ┌─────────────┐                                                    │
│  │ 错误处理中间件│                                                  │
│  └─────────────┘                                                    │
└─────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           控制器层                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │ 对话控制器  │  │ 模型控制器  │  │ 工具控制器  │  │ 系统控制器  │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  ┌─────────────┐                                                    │
│  │ 配置控制器  │                                                    │
│  └─────────────┘                                                    │
└─────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           服务层                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │ 对话服务    │  │ 模型服务    │  │ 工具服务    │  │ 配置管理服务│  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           工具层                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │ 通用工具    │  │ 日志工具    │  │ 错误处理工具│  │ 响应解析工具│  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           外部服务                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │ OpenAI API  │  │ Claude API  │  │ Gemini API  │  │ 其他AI服务  │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

### 架构说明

1. **前端应用层**：负责用户界面渲染和交互，通过API服务客户端与后端通信
2. **API路由层**：定义系统的所有API端点，处理路由分发和请求映射
3. **中间件层**：提供横切关注点功能，如安全、限流、日志记录和错误处理
4. **控制器层**：处理请求逻辑，调用相应的服务层方法并返回响应
5. **服务层**：实现核心业务逻辑，包括模型管理、对话处理和工具调用
6. **工具层**：提供通用功能支持，如日志记录、错误处理和响应解析
7. **外部服务**：对接各种第三方AI服务提供商的API

## 项目结构

```
/Users/mac/beth-new-2025/beth/fedev-large-model-ai/
├── backend/                # 后端服务目录
│   ├── config/             # 配置文件目录
│   │   └── config.js       # 主配置文件
│   ├── controllers/        # 控制器目录
│   │   ├── chatController.js      # 对话控制器
│   │   ├── configController.js    # 配置控制器
│   │   ├── modelController.js     # 模型控制器
│   │   ├── systemController.js    # 系统控制器
│   │   └── toolController.js      # 工具控制器
│   ├── middlewares/        # 中间件目录
│   │   ├── cors.js         # CORS中间件
│   │   ├── errorHandler.js # 错误处理中间件
│   │   ├── rateLimiter.js  # 限流中间件
│   │   ├── requestLogger.js # 请求日志中间件
│   │   └── security.js     # 安全中间件
│   ├── models/             # 数据模型目录
│   ├── routes/             # 路由目录
│   │   ├── chatRoutes.js      # 对话路由
│   │   ├── configRoutes.js    # 配置路由
│   │   ├── healthRoutes.js    # 健康检查路由
│   │   ├── index.js           # 路由入口
│   │   ├── modelRoutes.js     # 模型路由
│   │   ├── systemRoutes.js    # 系统路由
│   │   └── toolRoutes.js      # 工具路由
│   ├── server.js           # 后端服务器入口
│   ├── services/           # 服务目录
│   │   ├── chatService.js      # 对话服务
│   │   ├── configManager.js    # 配置管理服务
│   │   ├── modelService.js     # 模型服务
│   │   └── toolService.js      # 工具服务
│   ├── tests/              # 测试目录
│   │   └── api.test.js     # API测试文件
│   └── utils/              # 工具目录
│       ├── error.js        # 错误处理工具
│       ├── helpers.js      # 通用工具函数
│       ├── logger.js       # 日志工具
│       ├── response.js     # 响应工具
│       └── responseParser.js # 响应解析工具
├── src/                    # 前端源代码目录
│   ├── components/         # 前端组件
│   ├── models/             # 前端模型定义
│   ├── services/           # 前端服务
│   ├── state/              # 状态管理
│   ├── styles/             # 样式文件
│   └── utils/              # 前端工具函数
├── interview/              # 面试相关资料和历史版本
│   └── README_V0.1.md      # 原始版本README
├── public/                 # 静态资源
├── doc/                    # 文档目录
├── package.json            # 项目配置和依赖
├── vite.config.js          # Vite配置文件
└── README.md               # 项目文档（当前文件）
```

## 快速开始

### 安装依赖

```bash
npm install
```

### 配置环境

1. 复制环境变量示例文件：

```bash
cp backend/.env.example backend/.env
```

2. 编辑`.env`文件，配置必要的环境变量。

### 开发模式

#### 启动前端开发服务器

```bash
npm run dev
```

#### 启动后端开发服务器

```bash
npm run dev:backend
```

### 构建项目

```bash
npm run build
```

### 启动生产服务

```bash
npm start
```

### 运行测试

```bash
npm test
```

## 核心功能

### 1. 模型管理
- 获取所有可用模型列表
- 获取特定模型的详细信息
- 获取模型提供商信息
- 验证模型兼容性和可用性
- 获取模型支持的功能特性
- 上下文窗口验证
- 模型使用统计和成本计算

### 2. 工具服务
- 文本分词和Token计算
- 输入数据验证
- 输出数据格式化
- API调用成本计算
- 文本实体提取
- 工具分类管理
- JSON解析和生成
- 唯一ID生成

### 3. 配置管理
- 获取当前系统配置
- 动态更新配置
- 配置验证
- 配置重新加载
- 配置历史记录
- 版本恢复
- 配置导入导出
- 配置模式获取
- 配置重置

### 4. 系统管理
- 获取系统配置
- 系统统计信息
- 健康检查
- 缓存管理
- 系统日志
- API版本信息
- 资源使用监控
- 环境变量管理

### 5. 安全机制
- API密钥认证
- 请求限流保护
- 输入验证和清理
- 敏感数据加密
- 安全HTTP头设置
- CORS配置

## API文档

### 模型管理API

| 端点 | 方法 | 描述 | 认证 |
|------|------|------|------|
| `/api/models` | GET | 获取所有可用模型 | 需要API密钥 |
| `/api/models/:modelId` | GET | 获取模型详细信息 | 需要API密钥 |
| `/api/models/provider/:providerId` | GET | 获取特定提供商的模型 | 需要API密钥 |
| `/api/models/default` | GET | 获取默认模型 | 需要API密钥 |
| `/api/models/validate/:modelId` | POST | 验证模型兼容性 | 需要API密钥 |
| `/api/models/features/:modelId` | GET | 获取模型支持的功能 | 需要API密钥 |

### 工具服务API

| 端点 | 方法 | 描述 | 认证 |
|------|------|------|------|
| `/api/tools` | GET | 获取所有可用工具 | 需要API密钥 |
| `/api/tools/:toolId` | GET | 获取工具详细信息 | 需要API密钥 |
| `/api/tools/tokenize` | POST | 文本分词处理 | 需要API密钥 |
| `/api/tools/validate` | POST | 输入数据验证 | 需要API密钥 |
| `/api/tools/calculate-cost` | POST | 计算API调用成本 | 需要API密钥 |

### 配置管理API

| 端点 | 方法 | 描述 | 认证 |
|------|------|------|------|
| `/api/config` | GET | 获取当前配置 | 需要API密钥 |
| `/api/config` | PUT | 更新配置 | 需要API密钥 |
| `/api/config/validate` | POST | 验证配置 | 需要API密钥 |
| `/api/config/reload` | POST | 重新加载配置 | 需要API密钥 |
| `/api/config/history` | GET | 获取配置历史 | 需要API密钥 |

### 系统管理API

| 端点 | 方法 | 描述 | 认证 |
|------|------|------|------|
| `/api/system/status` | GET | 获取系统状态 | 可选认证 |
| `/api/system/stats` | GET | 获取系统统计 | 需要API密钥 |
| `/api/system/health` | GET | 健康检查 | 无需认证 |
| `/api/system/version` | GET | 获取API版本 | 无需认证 |

## 配置说明

### 环境变量

系统使用以下关键环境变量：

- `PORT`: 服务器端口（默认：3000）
- `API_KEY`: 主API密钥
- `CORS_ORIGINS`: 允许的跨域来源
- `RATE_LIMIT_WINDOW`: 限流窗口（毫秒）
- `RATE_LIMIT_MAX`: 每个窗口最大请求数
- `LOG_LEVEL`: 日志级别（error, warn, info, debug）
- `NODE_ENV`: 环境类型（development, production, test）

### 配置文件

系统配置存储在`backend/config/config.js`中，包含以下主要部分：

- 服务器配置
- API配置
- 模型配置
- 安全配置
- 日志配置
- 缓存配置

## 部署指南

### 本地开发环境

按照快速开始部分的说明设置开发环境。

### 生产环境部署

1. 构建应用：
   ```bash
   npm run build
   ```

2. 设置生产环境变量：
   - 创建`.env.production`文件
   - 设置生产环境特定的配置

3. 启动服务：
   ```bash
   npm start
   ```

### Docker部署（推荐）

1. 创建Dockerfile：
   ```dockerfile
   FROM node:18-alpine
   WORKDIR /app
   COPY package*.json ./
   RUN npm install --production
   COPY . .
   RUN npm run build
   EXPOSE 3000
   CMD ["npm", "start"]
   ```

2. 构建镜像：
   ```bash
   docker build -t ai-model-system .
   ```

3. 运行容器：
   ```bash
   docker run -d -p 3000:3000 --env-file .env.production ai-model-system
   ```

## 安全最佳实践

1. **API密钥管理**：
   - 不要在代码中硬编码API密钥
   - 使用环境变量或安全的密钥管理服务
   - 定期轮换API密钥

2. **输入验证**：
   - 对所有用户输入进行严格验证
   - 使用参数验证模式检查类型和格式
   - 清理所有输入数据以防止注入攻击

3. **访问控制**：
   - 实现适当的认证和授权机制
   - 对敏感操作使用更严格的权限检查
   - 记录所有关键操作的审计日志

4. **限流保护**：
   - 为API端点实施速率限制
   - 监控异常流量模式
   - 实现IP级别的限流以防止DDoS攻击

5. **数据保护**：
   - 加密敏感数据
   - 使用HTTPS进行所有通信
   - 实现适当的数据备份和恢复策略

## 测试策略

系统包含以下类型的测试：

1. **单元测试**：测试各个组件的独立功能
2. **集成测试**：测试组件之间的交互
3. **API测试**：测试REST API端点的行为
4. **性能测试**：测试系统在负载下的性能

运行测试：
```bash
npm test
```

## 监控和日志

系统使用结构化日志记录关键事件和错误，支持不同的日志级别：

- **ERROR**: 记录错误和异常
- **WARN**: 记录警告和潜在问题
- **INFO**: 记录一般信息和操作
- **DEBUG**: 记录详细的调试信息

日志包含以下信息：
- 时间戳
- 日志级别
- 消息内容
- 上下文数据
- 请求ID（用于跟踪请求）

## 许可证

MIT License

## 贡献指南

欢迎提交Issue和Pull Request来改进这个项目。在提交之前，请确保：

1. 遵循项目的代码风格和规范
2. 为新功能添加适当的测试
3. 更新相关文档
4. 提交清晰的变更描述

## 联系方式

如有任何问题或建议，请通过以下方式联系项目维护者：

- GitHub Issues：https://github.com/orange-cxy/fedev-large-model-ai/issues
- 项目邮箱：[项目维护邮箱]

---

*最后更新：2024年*