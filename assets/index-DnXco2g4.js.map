{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["../../src/main.js"],"sourcesContent":["import './style.css'\n\n// 尝试导入模式配置（可能由启动脚本生成）\nlet modeConfig = null;\ntry {\n  // 使用动态导入避免构建错误\n  import('./mode-config.js').then(config => {\n    modeConfig = config.default || config;\n    console.log('导入的模式配置:', modeConfig);\n  }).catch(error => {\n    console.log('未找到模式配置文件，使用默认配置');\n  });\n} catch (e) {\n  console.log('导入模式配置出错:', e);\n}\n\n// 创建Hello Deepseek内容\nconst app = document.getElementById('app');\napp.innerHTML = `\n  <div class=\"container\">\n    <h1>Hello Deepseek!</h1>\n    <div class=\"mode-switcher\">\n      <button id=\"btn-mock\" class=\"mode-btn active\">Mock模式</button>\n      <button id=\"btn-real\" class=\"mode-btn\">真实模式</button>\n    </div>\n    <div id=\"current-mode\" class=\"mode-info\">当前模式: Mock</div>\n    <div id=\"reply\" class=\"reply\">thinking...</div>\n    <button id=\"refresh-btn\" class=\"refresh-btn\">刷新响应</button>\n  </div>\n`;\n\n// 添加样式\nconst style = document.createElement('style');\nstyle.textContent = `\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 100vh;\n    margin: 0;\n    background-color: #f0f7ff;\n  }\n  .container {\n    text-align: center;\n    padding: 2rem;\n    background-color: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n  }\n  h1 {\n    color: #3498db;\n    margin-bottom: 1.5rem;\n  }\n  .reply {\n    padding: 1rem;\n    background-color: #f8f9fa;\n    border-radius: 8px;\n    border-left: 4px solid #3498db;\n    min-height: 60px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.1rem;\n  }\n`;\ndocument.head.appendChild(style);\n\n// 检查是否为mock模式\nfunction isMockMode() {\n  try {\n    // 1. 首先检查localStorage（由用户手动切换按钮设置，最高优先级）\n    const localStorageMode = localStorage.getItem('app_mode');\n    if (localStorageMode === 'mock' || localStorageMode === 'real') {\n      const isMock = localStorageMode === 'mock';\n      console.log(`LocalStorage模式: ${isMock ? 'mock' : '真实'}`);\n      return isMock;\n    }\n    \n    // 2. 检查URL参数\n    const urlParams = new URLSearchParams(window.location.search);\n    const mockParam = urlParams.get('mock');\n    if (mockParam !== null) {\n      const isMock = mockParam === 'true';\n      console.log(`URL参数模式: ${isMock ? 'mock' : '真实'}`);\n      return isMock;\n    }\n    \n    // 3. 检查modeConfig（由启动脚本生成）\n    if (modeConfig && modeConfig.app_mode) {\n      const isMock = modeConfig.app_mode === 'mock';\n      console.log(`配置文件模式: ${isMock ? 'mock' : '真实'}`);\n      return isMock;\n    }\n    \n    // 4. 检查环境变量（在浏览器环境中通过import.meta.env获取）\n    const isEnvMock = import.meta.env?.NODE_ENV === 'mock';\n    const isEnvReal = import.meta.env?.NODE_ENV === 'real';\n    if (isEnvMock || isEnvReal) {\n      const isMock = isEnvMock;\n      console.log(`环境变量模式: ${isMock ? 'mock' : '真实'}`);\n      return isMock;\n    }\n    \n    // 5. 默认模式（为了安全默认使用mock模式）\n    console.log('默认模式: mock');\n    return true;\n  } catch (e) {\n    console.error('检查mock模式出错:', e);\n    return true;\n  }\n}\n\n// 设置当前模式\nfunction setMode(isMock) {\n  localStorage.setItem('app_mode', isMock ? 'mock' : 'real');\n  \n  // 更新UI\n  document.getElementById('btn-mock').classList.toggle('active', isMock);\n  document.getElementById('btn-real').classList.toggle('active', !isMock);\n  document.getElementById('current-mode').textContent = `当前模式: ${isMock ? 'Mock' : '真实'}`;\n  \n  console.log(`模式已切换为: ${isMock ? 'mock' : 'real'}`);\n}\n\n// 初始化模式切换\nfunction initModeSwitcher() {\n  const btnMock = document.getElementById('btn-mock');\n  const btnReal = document.getElementById('btn-real');\n  const refreshBtn = document.getElementById('refresh-btn');\n  \n  // 初始状态\n  const initialMode = isMockMode();\n  setMode(initialMode);\n  \n  // 添加事件监听器\n  btnMock.addEventListener('click', () => {\n    setMode(true);\n    fetchResponse(); // 切换后重新获取响应\n  });\n  \n  btnReal.addEventListener('click', () => {\n    setMode(false);\n    fetchResponse(); // 切换后重新获取响应\n  });\n  \n  refreshBtn.addEventListener('click', () => {\n    fetchResponse();\n  });\n}\n\n// 保存响应到文件的函数（仅在非mock模式下执行）\nasync function saveResponseToFile(responseData) {\n  // 在mock模式下不保存响应\n  if (isMockMode()) {\n    console.log('Mock模式下，不保存响应到文件');\n    return;\n  }\n  \n  // 准备要保存的数据，包括响应和元信息\n  const saveData = {\n    timestamp: new Date().toISOString(),\n    response: responseData,\n    request: {\n      model: 'deepseek-chat',\n      messages: [\n        {role: \"system\", content: \"You are a helpful assistant.\"},\n        {role: \"user\", content: \"你好 Deepseek\"}\n      ]\n    }\n  };\n  \n  try {\n    // 调用后端API保存文件\n    const response = await fetch('http://localhost:3001/api/save-chat', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(saveData)\n    });\n    \n    const result = await response.json();\n    \n    if (result.success) {\n      console.log(result.message);\n      // 可以在这里添加成功提示给用户\n    } else {\n      console.error('保存失败:', result.message);\n    }\n  } catch (error) {\n    console.error('保存文件时发生错误:', error);\n    \n    // 降级处理：如果后端服务不可用，退回到浏览器下载方式\n    fallbackToBrowserDownload(saveData);\n  }\n}\n\n// 降级处理：浏览器下载方式\nfunction fallbackToBrowserDownload(saveData) {\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n  const fileName = `${timestamp}-response.json`;\n  \n  const blob = new Blob([JSON.stringify(saveData, null, 2)], { type: 'application/json' });\n  const link = document.createElement('a');\n  link.href = URL.createObjectURL(blob);\n  link.download = fileName;\n  \n  document.body.appendChild(link);\n  link.click();\n  \n  document.body.removeChild(link);\n  URL.revokeObjectURL(link.href);\n  \n  console.log(`由于后端服务不可用，响应已保存为 ${fileName}（下载到您的默认下载文件夹）`);\n}\n\n// Deepseek API调用代码\nasync function fetchDeepseekResponse() {\n  const mockMode = isMockMode();\n  console.log(`当前模式: ${mockMode ? 'Mock' : '真实'}`);\n  \n  try {\n    let response;\n    if (mockMode) {\n      // Mock模式：调用模拟API\n      console.log('使用Mock API');\n      response = await fetch('http://localhost:3001/api/mock-deepseek', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          prompt: \"你好 Deepseek\"\n        })\n      });\n    } else {\n      // 真实模式：调用真实Deepseek API\n      console.log('使用真实Deepseek API');\n      // 这里保留原有逻辑，实际使用时需要配置API密钥\n      const endpoint = 'https://api.deepseek.com/chat/completions';\n      const headers = {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${import.meta.env.VITE_DEEPSEEK_API_KEY || 'demo_key'}`\n      };\n\n      const payload = {\n        model: 'deepseek-chat',\n        messages: [\n          {role: \"system\", content: \"You are a helpful assistant.\"},\n          {role: \"user\", content: \"你好 Deepseek\"}\n        ],\n        stream: false\n      };\n      \n      response = await fetch(endpoint, {\n        method: 'POST',\n        headers: headers,\n        body: JSON.stringify(payload)\n      });\n    }\n\n    if (!response.ok) {\n      throw new Error(`${mockMode ? '模拟' : '真实'}API错误: ${response.status}`);\n    }\n\n    const data = await response.json();\n    const assistantReply = data.choices[0].message.content;\n    \n    // 保存响应到文件（saveResponseToFile内部会检查是否为mock模式）\n    // 注意：这里不使用await，避免阻塞返回\n    saveResponseToFile(data).catch(err => console.error('保存响应失败:', err));\n    \n    // 返回响应内容，让fetchResponse函数可以设置到界面上\n    return assistantReply;\n  } catch (error) {\n    console.error(`${mockMode ? '获取模拟' : '获取真实'}Deepseek响应失败:`, error);\n    \n    // 使用模拟数据作为降级方案\n    const fallbackReply = `这是一条${mockMode ? '模拟' : '测试'}响应数据${mockMode ? '，用于验证Mock模式功能。' : '，用于验证保存功能。'}`;\n    \n    // 不在这里设置UI，让调用者来处理\n    return fallbackReply;\n  }\n}\n\n// 获取响应的主函数\nasync function fetchResponse() {\n  const replyElement = document.getElementById('reply');\n  replyElement.textContent = 'thinking...';\n  \n  // 显示当前模式\n  const isMock = isMockMode();\n  document.getElementById('current-mode').textContent = `当前模式: ${isMock ? 'Mock' : '真实'}`;\n\n  try {\n    const response = await fetchDeepseekResponse();\n    replyElement.textContent = response;\n    \n    // 保存响应到文件（仅在非mock模式下）\n    if (!isMock) {\n      await saveResponseToFile(response);\n    }\n  } catch (error) {\n    console.error('获取响应失败:', error);\n    replyElement.textContent = `获取响应失败: ${error.message}`;\n  }\n}\n\n// 初始化模式切换器\ninitModeSwitcher();\n\n// 立即执行获取响应\nfetchResponse();\n"],"file":"assets/index-DnXco2g4.js"}