{"version":3,"file":"cozeV3-jeLll5cu.js","names":[],"sources":["../../src/models/cozeV3.js"],"sourcesContent":["// CozeV3模型的格式化函数\nexport const formatPayload = (messages, options = {}) => {\n  return {\n    \"modelId\": \"cozeV3\",\n    \"bot_id\": import.meta.env.VITE_COZE_BOT_ID,\n    \"user_id\": import.meta.env.VITE_COZE_USER_ID,\n    \"stream\": options.stream || false,\n    query: '你好',\n    chat_history: [], \n    custom_variables: { prompt: messages }\n  };\n};\n\nexport const formatResponse = (data) => {\n  return {\n    context: data.msg\n  };\n};\n\n// 添加流式响应解析函数\nexport const parseStreamChunk = (chunk) => {\n  try {\n    // 解析coze的流式响应格式\n    // 格式通常为: data:{\"event\":\"message\",\"message\":{\"role\":\"assistant\",\"type\":\"answer\",\"content\":\"...\"}}\n    \n    console.log('CozeV3 parsing chunk:', typeof chunk, chunk);\n    \n    // 如果chunk已经是解析好的对象，直接使用\n    if (typeof chunk === 'object' && chunk !== null) {\n      // 检查是否是嵌套结构\n      if (chunk.event === 'message' && chunk.message && chunk.message.role === 'assistant') {\n        return chunk.message.content || '';\n      }\n      // 检查message对象是否直接在顶层\n      if (chunk.message && chunk.message.role === 'assistant') {\n        return chunk.message.content || '';\n      }\n      return '';\n    }\n    \n    // 如果chunk是字符串，尝试多种解析方式\n    if (typeof chunk === 'string') {\n      // 提取JSON部分（去掉可能的'data:'前缀）\n      let jsonStr = chunk;\n      if (chunk.startsWith('data:')) {\n        jsonStr = chunk.substring(5).trim();\n      }\n      \n      // 尝试解析JSON字符串\n      const parsed = JSON.parse(jsonStr);\n      \n      // 检查多种可能的数据结构\n      if (parsed.event === 'message' && parsed.message && parsed.message.role === 'assistant') {\n        return parsed.message.content || '';\n      }\n      if (parsed.message && parsed.message.role === 'assistant') {\n        return parsed.message.content || '';\n      }\n    }\n    \n    return '';\n  } catch (error) {\n    console.error('解析CozeV3流式响应失败:', error, 'Chunk:', chunk);\n    return '';\n  }\n};"],"mappings":"AACA,MAAa,EAAA,CAAiB,EAAU,EAAU,CAAA,KACzC,CACL,QAAW,SACX,YAAA,EACA,aAAA,EACA,OAAU,EAAQ,SAAU,EAC5B,MAAO,KACP,aAAc,GACd,iBAAkB,CAAE,OAAQ,KAInB,EAAkB,IACtB,CACL,QAAS,EAAK,MAKL,EAAoB,IAC/B,IAOE,GAHA,QAAQ,IAAI,+BAAgC,EAAO,GAG9B,iBAAV,GAAgC,OAAV,EAE/B,MAAoB,YAAhB,EAAM,OAAuB,EAAM,SAAkC,cAAvB,EAAM,QAAQ,KACvD,EAAM,QAAQ,SAAW,GAG9B,EAAM,SAAkC,cAAvB,EAAM,QAAQ,MAC1B,EAAM,QAAQ,SAEhB,GAIT,GAAqB,iBAAV,EAAoB,CAE7B,IAAI,EAAU,EACV,EAAM,WAAW,WACnB,EAAU,EAAM,UAAU,GAAG,QAI/B,MAAM,EAAS,KAAK,MAAM,GAG1B,GAAqB,YAAjB,EAAO,OAAuB,EAAO,SAAmC,cAAxB,EAAO,QAAQ,KACjE,OAAO,EAAO,QAAQ,SAAW,GAEnC,GAAI,EAAO,SAAmC,cAAxB,EAAO,QAAQ,KACnC,OAAO,EAAO,QAAQ,SAAW,GAIrC,MAAO,SACA,GAEP,OADA,QAAQ,MAAM,kBAAmB,EAAO,SAAU,GAC3C"}