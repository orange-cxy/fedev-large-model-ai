{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["../../src/models-config.js","../../src/main.js"],"sourcesContent":["// 大模型配置文件\nexport const models = [\n  {\n    id: 'deepseek',\n    name: 'Deepseek',\n    endpoint: 'https://api.deepseek.com/chat/completions',\n    apiKeyEnv: 'VITE_DEEPSEEK_API_KEY',\n    defaultKey: 'demo_key',\n    model: 'deepseek-chat',\n    mockEndpoint: 'http://localhost:3001/api/mock-api',\n    // Deepseek模型的请求格式化函数\n    formatPayload: (messages, options = {}) => {\n      return {\n        \"model\": \"deepseek-chat\",\n        \"modelId\": \"deepseek\",\n        \"messages\": [\n          {\"role\": \"system\", \"content\": \"You are a helpful assistant.\"},\n          {\"role\": \"user\", \"content\": messages}\n        ],\n        \"stream\": options.stream || false,\n      };\n    },\n    formatResponse: (data) => {\n        return {\n            context: data.choices[0].message.content\n        }\n    }\n  },\n  {\n    id: 'cozeV3',\n    name: 'CozeV3',\n    endpoint: 'https://api.coze.cn/v3/chat',\n    apiKeyEnv: 'VITE_COZE_API_KEY',\n    defaultKey: 'demo_key',\n    model: 'coze-chat',\n    mockEndpoint: 'http://localhost:3001/api/mock-api',\n    // Coze模型的请求格式化函数\n    formatPayload: (messages, options = {}) => {\n      return {\n        \"modelId\": \"cozeV3\",\n        \"bot_id\": import.meta.env.VITE_COZE_BOT_ID,\n        \"user_id\": import.meta.env.VITE_COZE_USER_ID,\n        \"stream\": false,\n        query: '你好', chat_history: [], \n        custom_variables: { prompt: messages },\n        // \"additional_messages\": [\n        //     {\n        //     \"content\": messages,\n        //     \"content_type\": \"text\",\n        //     \"role\": \"user\",\n        //     \"type\": \"question\"\n        //     }\n        // ],\n        // \"parameters\": {}\n      };\n    },\n    formatResponse: (data) => {\n        return {\n            context: data.msg\n        }\n    },\n  },\n  {\n    id: 'cozeV2',\n    name: 'CozeV2',\n    endpoint: 'https://api.coze.cn/open_api/v2/chat',\n    apiKeyEnv: 'VITE_COZE_API_KEY',\n    defaultKey: 'demo_key',\n    model: 'coze-chat',\n    mockEndpoint: 'http://localhost:3001/api/mock-api',\n    // Coze模型的请求格式化函数\n    formatPayload: (messages, options = {}) => {\n      return {\n        \"modelId\": \"cozeV2\",\n        \"bot_id\": import.meta.env.VITE_COZE_BOT_ID,\n        \"user\": import.meta.env.VITE_COZE_USER_ID,\n        query: messages,\n        chat_history: [],\n        stream: false,\n        custom_variables: { prompt: messages }\n      };\n    },\n    formatResponse: (data) => {\n        return {\n            context: data.messages[0].content\n        }\n    },\n  },\n  {\n    id: \"kimi-k2-0905-preview\",\n    name: \"kimi-k2-0905-preview\",\n    endpoint: 'https://api.moonshot.cn/v1/chat/completions',\n    apiKeyEnv: 'VITE_MOONSHOT_API_KEY',\n    defaultKey: 'demo_key',\n    model: 'coze-chat',\n    mockEndpoint: 'http://localhost:3001/api/mock-api',\n    // Coze模型的请求格式化函数\n    formatPayload: (messages, options = {}) => {\n      return {\n        \"model\": \"kimi-k2-0905-preview\",\n        \"messages\": [\n            {\n                \"role\": \"system\",\n                \"content\": messages\n            }\n        ],\n        \"temperature\": 0.3,\n        \"max_tokens\": 8192,\n        \"top_p\": 1,\n        \"stream\": false\n      };\n    },\n    formatResponse: (data) => {\n        return {\n            context: data.choices[0].message.content\n        }\n    },\n  }\n];\n\n// 中间件函数：根据模型格式化请求reponsoe\nexport function formatResponseForModel(model, response) {\n  if (model.formatResponse && typeof model.formatResponse === 'function') {\n    return model.formatResponse(response);\n  }\n\n  return {\n    context: \"\"\n  }\n}\n\n// 中间件函数：根据模型格式化请求payload\nexport function formatPayloadForModel(model, messages, options = {}) {\n  if (model.formatPayload && typeof model.formatPayload === 'function') {\n    return model.formatPayload(messages, options);\n  }\n  \n  // 默认格式化函数（兼容OpenAI风格）\n  return {\n    model: model.model,\n    messages,\n    choices: {\n        messages,\n    },\n    stream: options.stream || false\n  };\n}\n\n// 中间件函数：处理响应数据，统一格式\nexport function processResponseForModel(model, rawResponse) {\n  // 这里可以根据不同模型的响应格式进行标准化处理\n  // 目前假设所有模型都返回与OpenAI兼容的格式\n  return rawResponse;\n}\n\n// 获取默认模型\nexport function getDefaultModel() {\n  return models[0];\n}\n\n// 根据ID获取模型\nexport function getModelById(id) {\n  return models.find(model => model.id === id) || getDefaultModel();\n}\n\n// 获取当前选中的模型\nexport function getCurrentModel() {\n  const savedModelId = localStorage.getItem('selected_model');\n  return savedModelId ? getModelById(savedModelId) : getDefaultModel();\n}\n\n// 设置当前选中的模型\nexport function setCurrentModel(modelId) {\n  localStorage.setItem('selected_model', modelId);\n}","import './style.css'\nimport { models, getCurrentModel, setCurrentModel, formatPayloadForModel, formatResponseForModel } from './models-config.js'\n\n// 尝试导入模式配置（可能由启动脚本生成）\nlet modeConfig = null;\ntry {\n  // 使用动态导入避免构建错误\n  import('./mode-config.js').then(config => {\n    modeConfig = config.default || config;\n    console.log('导入的模式配置:', modeConfig);\n  }).catch(error => {\n    console.log('未找到模式配置文件，使用默认配置');\n  });\n} catch (e) {\n  console.log('导入模式配置出错:', e);\n}\n\n// 创建应用内容，支持多模型切换\nconst app = document.getElementById('app');\napp.innerHTML = `\n  <div class=\"container\">\n    <h1>AI 对话助手</h1>\n    <div class=\"model-selector\">\n      <label for=\"model-select\">选择模型：</label>\n      <select id=\"model-select\"></select>\n    </div>\n    <div class=\"mode-switcher\">\n      <button id=\"btn-mock\" class=\"mode-btn active\">Mock模式</button>\n      <button id=\"btn-real\" class=\"mode-btn\">真实模式</button>\n    </div>\n    <div id=\"current-status\" class=\"status-info\">当前状态: Mock | Deepseek</div>\n    <div id=\"reply\" class=\"reply\">thinking...</div>\n    <button id=\"refresh-btn\" class=\"refresh-btn\">刷新响应</button>\n  </div>\n`;\n\n// 添加样式\nconst style = document.createElement('style');\nstyle.textContent = `\n  body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 100vh;\n    margin: 0;\n    background-color: #f0f7ff;\n  }\n  .container {\n    text-align: center;\n    padding: 2rem;\n    background-color: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n  }\n  h1 {\n    color: #3498db;\n    margin-bottom: 1.5rem;\n  }\n  .reply {\n    padding: 1rem;\n    background-color: #f8f9fa;\n    border-radius: 8px;\n    border-left: 4px solid #3498db;\n    min-height: 60px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.1rem;\n    margin-bottom: 1rem;\n  }\n  .model-selector {\n    margin-bottom: 1rem;\n  }\n  .model-selector select {\n    padding: 0.5rem;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    font-size: 1rem;\n  }\n  .status-info {\n    margin-bottom: 1rem;\n    font-size: 0.9rem;\n    color: #666;\n  }\n  .mode-switcher {\n    display: flex;\n    justify-content: center;\n    gap: 0.5rem;\n    margin-bottom: 1rem;\n  }\n  .mode-btn {\n    padding: 0.5rem 1rem;\n    border: 1px solid #ddd;\n    background-color: #f8f9fa;\n    border-radius: 4px;\n    cursor: pointer;\n  }\n  .mode-btn.active {\n    background-color: #3498db;\n    color: white;\n    border-color: #3498db;\n  }\n  .refresh-btn {\n    padding: 0.5rem 1.5rem;\n    background-color: #2ecc71;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 1rem;\n  }\n  .refresh-btn:hover {\n    background-color: #27ae60;\n  }\n`;\ndocument.head.appendChild(style);\n\n// 检查是否为mock模式\nfunction isMockMode() {\n  try {\n    // 1. 首先检查localStorage（由用户手动切换按钮设置，最高优先级）\n    const localStorageMode = localStorage.getItem('app_mode');\n    if (localStorageMode === 'mock' || localStorageMode === 'real') {\n      const isMock = localStorageMode === 'mock';\n      console.log(`LocalStorage模式: ${isMock ? 'mock' : '真实'}`);\n      return isMock;\n    }\n    \n    // 2. 检查URL参数\n    const urlParams = new URLSearchParams(window.location.search);\n    const mockParam = urlParams.get('mock');\n    if (mockParam !== null) {\n      const isMock = mockParam === 'true';\n      console.log(`URL参数模式: ${isMock ? 'mock' : '真实'}`);\n      return isMock;\n    }\n    \n    // 3. 检查modeConfig（由启动脚本生成）\n    if (modeConfig && modeConfig.app_mode) {\n      const isMock = modeConfig.app_mode === 'mock';\n      console.log(`配置文件模式: ${isMock ? 'mock' : '真实'}`);\n      return isMock;\n    }\n    \n    // 4. 检查环境变量（在浏览器环境中通过import.meta.env获取）\n    const isEnvMock = import.meta.env?.NODE_ENV === 'mock';\n    const isEnvReal = import.meta.env?.NODE_ENV === 'real';\n    if (isEnvMock || isEnvReal) {\n      const isMock = isEnvMock;\n      console.log(`环境变量模式: ${isMock ? 'mock' : '真实'}`);\n      return isMock;\n    }\n    \n    // 5. 默认模式（为了安全默认使用mock模式）\n    console.log('默认模式: mock');\n    return true;\n  } catch (e) {\n    console.error('检查mock模式出错:', e);\n    return true;\n  }\n}\n\n// 设置当前模式\nfunction setMode(isMock) {\n  localStorage.setItem('app_mode', isMock ? 'mock' : 'real');\n  \n  // 更新UI\n  document.getElementById('btn-mock').classList.toggle('active', isMock);\n  document.getElementById('btn-real').classList.toggle('active', !isMock);\n  updateStatusDisplay(isMock);\n  \n  console.log(`模式已切换为: ${isMock ? 'mock' : 'real'}`);\n}\n\n// 更新状态显示\nfunction updateStatusDisplay(isMock = null) {\n  const currentIsMock = isMock !== null ? isMock : isMockMode();\n  const currentModel = getCurrentModel();\n  document.getElementById('current-status').textContent = `当前状态: ${currentIsMock ? 'Mock' : '真实'} | ${currentModel.name}`;\n}\n\n// 初始化模型选择器\nfunction initModelSelector() {\n  const modelSelect = document.getElementById('model-select');\n  const currentModel = getCurrentModel();\n  \n  // 添加所有模型选项\n  models.forEach(model => {\n    const option = document.createElement('option');\n    option.value = model.id;\n    option.textContent = model.name;\n    option.selected = model.id === currentModel.id;\n    modelSelect.appendChild(option);\n  });\n  \n  // 添加事件监听器\n  modelSelect.addEventListener('change', (event) => {\n    const selectedModelId = event.target.value;\n    setCurrentModel(selectedModelId);\n    updateStatusDisplay();\n    fetchResponse(); // 切换模型后重新获取响应\n  });\n}\n\n// 初始化应用\nfunction initApp() {\n  const btnMock = document.getElementById('btn-mock');\n  const btnReal = document.getElementById('btn-real');\n  const refreshBtn = document.getElementById('refresh-btn');\n  \n  // 初始化模型选择器\n  initModelSelector();\n  \n  // 初始状态\n  const initialMode = isMockMode();\n  setMode(initialMode);\n  \n  // 添加事件监听器\n  btnMock.addEventListener('click', () => {\n    setMode(true);\n    fetchResponse(); // 切换后重新获取响应\n  });\n  \n  btnReal.addEventListener('click', () => {\n    setMode(false);\n    fetchResponse(); // 切换后重新获取响应\n  });\n  \n  refreshBtn.addEventListener('click', () => {\n    fetchResponse();\n  });\n}\n\n// 保存响应到文件的函数（仅在非mock模式下执行）\nasync function saveResponseToFile(responseData) {\n  // 在mock模式下不保存响应\n  if (isMockMode()) {\n    console.log('Mock模式下，不保存响应到文件');\n    return;\n  }\n  \n  const currentModel = getCurrentModel();\n  \n  // 准备要保存的数据，包括响应和元信息\n  const saveData = {\n    timestamp: new Date().toISOString(),\n    model: currentModel.id,\n    modelName: currentModel.name,\n    response: responseData,\n    request: currentModel.formatPayload(`你好 ${currentModel.name}`),\n  };\n  \n  try {\n    // 调用后端API保存文件\n    const response = await fetch('http://localhost:3001/api/save-chat', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(saveData)\n    });\n    \n    const result = await response.json();\n    \n    if (result.success) {\n      console.log(result.message);\n      // 可以在这里添加成功提示给用户\n    } else {\n      console.error('保存失败:', result.message);\n    }\n  } catch (error) {\n    console.error('保存文件时发生错误:', error);\n    \n    // 降级处理：如果后端服务不可用，退回到浏览器下载方式\n    // fallbackToBrowserDownload(saveData);\n  }\n}\n\n// 降级处理：浏览器下载方式\nfunction fallbackToBrowserDownload(saveData) {\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n  const modelId = saveData.model || 'unknown';\n  const fileName = `${timestamp}-${modelId}-response.json`;\n  \n  const blob = new Blob([JSON.stringify(saveData, null, 2)], { type: 'application/json' });\n  const link = document.createElement('a');\n  link.href = URL.createObjectURL(blob);\n  link.download = fileName;\n  \n  document.body.appendChild(link);\n  link.click();\n  \n  document.body.removeChild(link);\n  URL.revokeObjectURL(link.href);\n  \n  console.log(`由于后端服务不可用，响应已保存为 ${fileName}（下载到您的默认下载文件夹）`);\n}\n\n// 通用模型API调用代码\nasync function fetchModelResponse() {\n  const mockMode = isMockMode();\n  const currentModel = getCurrentModel();\n  console.log(`当前模型: ${currentModel.name}, 模式: ${mockMode ? 'Mock' : '真实'}`);\n  \n  try {\n    let response;\n    \n    // 准备消息内容\n    const messages = `你好 ${currentModel.name}`\n    \n    if (mockMode) {\n      // Mock模式：调用模拟API\n      console.log(`使用${currentModel.name}的Mock API`);\n      // 对于Mock模式，也可以使用格式化中间件\n      const mockPayload = formatPayloadForModel(currentModel, messages, {\n        // Mock模式特有的选项\n        isMock: true\n      });\n      \n      response = await fetch(currentModel.mockEndpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(mockPayload)\n      });\n    } else {\n      // 真实模式：调用真实API\n      console.log(`使用${currentModel.name}的真实API`, currentModel.apiKeyEnv, import.meta.env);\n      // 获取API密钥\n      const apiKey = import.meta.env[currentModel.apiKeyEnv] || currentModel.defaultKey;\n      \n      const headers = {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${apiKey}`\n      };\n\n      // 使用中间件函数格式化请求payload，根据不同模型生成不同格式\n      const payload = formatPayloadForModel(currentModel, messages, {\n        stream: false,\n      });\n      \n      console.log(`发送到${currentModel.name}的请求格式:`, JSON.stringify(payload, null, 2));\n      \n      response = await fetch(currentModel.endpoint, {\n        method: 'POST',\n        headers: headers,\n        body: JSON.stringify(payload)\n      });\n    }\n\n    if (!response.ok) {\n      throw new Error(`${mockMode ? '模拟' : '真实'}API错误: ${response.status}`);\n    }\n\n    const data = await response.json();\n    const assistantReply = formatResponseForModel(currentModel, data);\n    return {\n      response: data,\n      data: assistantReply,\n    }\n  } catch (error) {\n    console.error(`${mockMode ? '获取模拟' : '获取真实'}${currentModel.name}响应失败:`, error);\n    \n    // 使用模拟数据作为降级方案\n    const fallbackReply = `⚫ 这是一条${mockMode ? '模拟' : '测试'}响应数据（${currentModel.name}）${mockMode ? '，用于验证Mock模式功能。' : '，用于验证保存功能。'}`;\n    \n    // 不在这里设置UI，让调用者来处理\n    return {\n      response: null,\n      data: {\n        context: fallbackReply,\n      }\n    };\n  }\n}\n\n// 获取响应的主函数\nasync function fetchResponse() {\n  const replyElement = document.getElementById('reply');\n  replyElement.textContent = 'thinking...';\n  \n  // 更新状态显示\n  updateStatusDisplay();\n\n  try {\n    const response = await fetchModelResponse();\n    replyElement.textContent = response.data.context;\n    \n    // 保存响应到文件（仅在非mock模式下）\n    const isMock = isMockMode();\n    if (!isMock && !response.data.context.startsWith('⚫')) {\n      await saveResponseToFile(response.response);\n    }\n  } catch (error) {\n    console.error('获取响应失败:', error);\n    replyElement.textContent = `获取响应失败: ${error.message}`;\n  }\n}\n\n// 初始化应用\ninitApp();\n\n// 立即执行获取响应\nfetchResponse();\n"],"file":"assets/index-DNJrztiF.js"}